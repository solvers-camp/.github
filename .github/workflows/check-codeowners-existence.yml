  name: Check for codeowners existence
  
  on:
    workflow_call:
  
  jobs:
    check-for-codeowners_existence:
      name: Check  codeowners file existence
      runs-on: ubuntu-latest
      permissions:
        pull-requests: write
        contents: read
      steps:
        - uses: actions/checkout@v3
          timeout-minutes: 2
    
        # - name: Checkout reusable actions repo
        #   uses: actions/checkout@v3
        #   with:
        #     # repository: vyos/.github
        #     repository: solvers-camp/.github
        #     path: reusable-actions
  
        - name: check codeowners existence
          id: check_codeowneer_existence
          run: |
            CODEOWNERS_FILE_PATH=".github/CODEOWNERS"
            if [[ ! -f "$CODEOWNERS_FILE_PATH" ]]; then
              echo "CODEOWNERS file does not exist. Creating PR..."
              echo "CODEOWNERS_MISSING=true" >> $GITHUB_ENV
            else
              echo "CODEOWNERS file exists. No action needed."
            fi
          shell: bash
          
        - name: Create Pull Request
          uses: peter-evans/create-pull-request@v3
          with:
            token: ${{ secrets.GITHUB_TOKEN }}
            title: "Add CODEOWNERS file"
            body: "This PR adds a CODEOWNERS file to the repository."
            commit-message: "Add CODEOWNERS file"
            branch: "add-codeowners"
            assignees: Thilaga-26,kumvijaya
          if: env.CODEOWNERS_MISSING == 'true'

        - name: Add PR comment
          if: always()
          uses: mshick/add-pr-comment@v2
          with:
            message: |-
              ${{ env.CODEOWNERS_MISSING == 'true' && '‚ùå\nCODEOWNERS File NOTFOUND' || 'üëç\nCODEOWNERS EXISTS' }}
            message-id: "CODEOWNERS_VALIDATION"
            allow-repeats: false